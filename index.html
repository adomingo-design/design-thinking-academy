import { jsPDF } from "jspdf";

// ... dentro de tu componente ...

const downloadPDF = () => {
  const doc = new jsPDF();
  const pageWidth = doc.internal.pageSize.getWidth();
  
  // Estilos básicos
  doc.setFont("helvetica", "bold");
  doc.setFontSize(22);
  doc.setTextColor(30, 41, 59); // slate-800
  doc.text("Design Thinking Academy", 20, 20);
  
  // Subtítulo e Info
  doc.setFontSize(16);
  doc.setTextColor(79, 70, 229); // indigo-600
  doc.text(`Informe de Progreso: ${activePhase.title}`, 20, 32);
  
  doc.setDrawColor(226, 232, 240); // slate-200
  doc.line(20, 38, pageWidth - 20, 38);
  
  // Resumen de progreso
  doc.setFontSize(12);
  doc.setTextColor(100, 116, 139); // slate-500
  doc.setFont("helvetica", "normal");
  doc.text(`Progreso total: ${progressPercent}% (${completedTools.length}/${activePhase.tools.length} completados)`, 20, 48);
  doc.text(`URL de apoyo: ${activePhase.videoUrl}`, 20, 56);

  // Lista de herramientas
  doc.setFont("helvetica", "bold");
  doc.setTextColor(30, 41, 59);
  doc.text("Estado de las herramientas:", 20, 70);
  
  let yPos = 80;
  activePhase.tools.forEach((tool) => {
    const isDone = completedTools.includes(tool.id);
    
    // Dibujar checkbox
    doc.setDrawColor(203, 213, 225);
    doc.rect(20, yPos - 4, 5, 5);
    
    if (isDone) {
      doc.setTextColor(34, 197, 94); // green-600
      doc.text("X", 21, yPos);
      doc.setTextColor(30, 41, 59);
      doc.text(`${tool.name} (Completado)`, 28, yPos);
    } else {
      doc.setTextColor(148, 163, 184); // slate-400
      doc.text(`${tool.name} (Pendiente)`, 28, yPos);
    }
    
    yPos += 10;
  });

  // Pie de página
  doc.setFontSize(10);
  doc.setTextColor(148, 163, 184);
  doc.text(`Generado el ${new Date().toLocaleDateString()}`, 20, 280);

  doc.save(`progreso-${activePhase.id}.pdf`);
};

return (
  <main className="bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-slate-100">
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
      {/* COLUMNA IZQUIERDA (Se mantiene igual) */}
      <section className="lg:col-span-2">
        <div className="flex flex-col md:flex-row justify-between items-start gap-4 mb-8">
          <div>
            <h2 className="text-3xl font-black text-slate-800 mb-2">{activePhase.title}</h2>
            <p className="text-slate-500 text-lg leading-relaxed max-w-2xl">
              {activePhase.description}
            </p>
          </div>

          <button
            onClick={() => copyToClipboard(activePhase.videoUrl, activePhase.id)}
            className={`px-4 py-2 rounded-xl border-2 font-bold text-sm transition-all flex items-center gap-2 ${
              copiedId === activePhase.id
                ? "bg-green-100 border-green-500 text-green-700"
                : "bg-slate-50 border-slate-200 text-slate-600 hover:bg-white hover:border-indigo-300"
            }`}
          >
            <span>{copiedId === activePhase.id ? "✓ Copiat!" : "Copiar URL Vídeo"}</span>
          </button>
        </div>

        <div className="grid gap-6">
          {activePhase.tools.map(tool => (
            <div
              key={tool.id}
              className={`p-6 rounded-2xl border-2 transition-all ${
                completedTools.includes(tool.id)
                  ? "bg-green-50 border-green-200 shadow-inner"
                  : "bg-white border-slate-100 hover:border-indigo-100 shadow-sm"
              }`}
            >
              <div className="flex justify-between items-center gap-4">
                <div className="flex-1">
                  <h3 className={`font-bold text-xl mb-1 ${completedTools.includes(tool.id) ? "text-green-800" : "text-slate-800"}`}>
                    {tool.name}
                  </h3>
                  <p className="text-sm text-slate-500 mb-4 italic font-medium">{tool.desc}</p>
                  <div className="bg-white/50 p-4 rounded-xl text-slate-700 border border-slate-100/50">
                    {tool.content}
                  </div>
                </div>

                <button
                  onClick={() => toggleTool(tool.id)}
                  className={`w-12 h-12 shrink-0 rounded-full flex items-center justify-center font-bold text-2xl transition-all active:scale-90 ${
                    completedTools.includes(tool.id)
                      ? "bg-green-500 text-white shadow-md shadow-green-200"
                      : "bg-indigo-100 text-indigo-600 hover:bg-indigo-600 hover:text-white"
                  }`}
                >
                  {completedTools.includes(tool.id) ? "✓" : "+"}
                </button>
              </div>
            </div>
          ))}
        </div>
      </section>

      {/* COLUMNA DERECHA */}
      <aside className="lg:col-span-1">
        <div className="lg:sticky lg:top-6 space-y-4">
          <div className="rounded-2xl border border-slate-200 bg-indigo-950 text-white p-5 shadow-sm">
            <div className="flex flex-col gap-4 mb-4">
              <div className="font-black text-lg">Resumen de Fase</div>

              <div className="flex gap-2">
                <button
                  onClick={downloadPDF}
                  className="flex-1 px-3 py-2 rounded-xl bg-indigo-500 text-white text-xs font-bold hover:bg-indigo-400 transition flex items-center justify-center gap-1"
                >
                  <span className="text-lg">↓</span> PDF
                </button>
                
                <button
                  onClick={() => {
                    /* Tu lógica anterior de TXT se mantiene aquí si quieres conservarla */
                  }}
                  className="px-3 py-2 rounded-xl bg-white/10 border border-white/20 text-xs font-bold hover:bg-white/15 transition"
                >
                  TXT
                </button>
              </div>
            </div>

            <div className="text-sm text-indigo-100 mb-4">
              {activePhase.title}
            </div>

            <div className="space-y-2">
              {activePhase.tools.map(t => {
                const ok = completedTools.includes(t.id);
                return (
                  <div key={t.id} className="flex items-start gap-2">
                    <div className={`mt-1 w-3 h-3 rounded-full border ${ok ? "bg-green-400 border-green-300" : "bg-transparent border-white/40"}`}></div>
                    <div className={`text-sm ${ok ? "text-white" : "text-indigo-100"}`}>
                      {t.name}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>

          <div className="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
            <div className="text-sm font-black text-slate-800 mb-2">Tip rápido</div>
            <div className="text-sm text-slate-600">
              Marca herramientas conforme las completes. El PDF generado incluirá los checks verdes.
            </div>
          </div>
        </div>
      </aside>
    </div>
  </main>
);
